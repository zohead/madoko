/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";define("vs/languages/typescript/common/participants/filenameSuggestions",["require","exports","vs/base/common/uri","vs/base/common/strings","vs/base/common/paths","vs/base/common/collections","vs/base/common/winjs.base","vs/languages/typescript/common/lib/typescriptServices","vs/languages/typescript/common/project/projectService"],function(e,t,n,r,i,o,s,a,c){var l=function(){function e(){}return e.prototype.makeModulePath=function(e,t,n){return e?this._toRequirePath(t,n):this._toReferencesPath(t,n)},e.prototype._toRequirePath=function(e,t){var n,o=i.dirname(t);return n=i.join(i.relative(o,i.dirname(e)),i.basename(e)),r.startsWith(n,"..")||(n="./"+n),n=r.rtrim(n,".ts"),n=r.rtrim(n,".js")},e.prototype._toReferencesPath=function(e,t){var n=i.dirname(t);return i.join(i.relative(n,i.dirname(e)),i.basename(e))},e}();t.PathMaker=l;var u=function(){function e(e){this._resourceServices=e.resourceService}return e.prototype.suggest=function(e,t,i){if(!(i instanceof c.ProjectService))return s.TPromise.as(null);var a=i.getProject(e),u=a.languageService.getSourceFile(e.toString()),d=this._findCurrentWord(e,t,u);if(!d)return s.TPromise.as(null);var p=new l,h=/^['"]/.test(d.wordUntilPosition)?d.wordUntilPosition[0]:'"',m={currentWord:d.wordUntilPosition,suggestions:[]},f=Object.create(null);return i.scriptsNames().forEach(function(t){if(!(d.external&&r.endsWith(t,".d.ts")||t===e.toString()||f[t]||"file"!==n.parse(t).scheme)){var i=p.makeModulePath(d.external,t,e.toString());f[t]={label:r.format("{0}{1}{0}",h,i),codeSnippet:r.rtrim(r.format("{0}{1}{0}",h,i),d.wordAfterPosition),documentationLabel:n.parse(t).fsPath,type:"reference"}}}),m.suggestions=o.values(f),s.TPromise.as(m)},e.prototype._findCurrentWord=function(t,n,r){var i=this._resourceServices.get(t),o=i.getOffsetFromPosition(n),s=a.findTokenOnLeftOfPosition(r,o),c=i.getLineContent(n.lineNumber),l=e._TrippleSlashReference.exec(c);if(l){var u=i.getOffsetFromPosition({lineNumber:n.lineNumber,column:1});return{wordUntilPosition:l[2].substring(0,o-(u+l[1].length)),wordAfterPosition:l[2].substring(o-(u+l[1].length)),external:!1}}if(d.isTokenPath(s,8,160))return{wordUntilPosition:a.getTextOfNode(s).substr(0,o-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(o-s.getStart()),external:!0};if(d.isTokenPath(s,8,156,160)){var p=d.parent(s,2);if("require"===a.getTextOfNode(p.expression)||"define"===a.getTextOfNode(p.expression))return{wordUntilPosition:a.getTextOfNode(s).substr(0,o-s.getStart()),wordAfterPosition:a.getTextOfNode(s).substr(o-s.getStart()),external:!0}}},e._TrippleSlashReference=/^(\/\/\/\s*<reference\s+path=)([^\s>]+)/i,e}();t.FilenameSuggestions=u;var d;!function(e){function t(e,t){for(;t-->0&&e;)e=e.parent;return e}function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(;t.length>0&&e;){var r=t.shift();if(r!==e.kind)return!1;e=e.parent}return!0}e.parent=t,e.isTokenPath=n}(d||(d={}))});